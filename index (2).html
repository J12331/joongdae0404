<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>학생 성적 조회</title>
  <style>
    body { font-family: sans-serif; max-width: 500px; margin: 2em auto; }
    table { border-collapse: collapse; width: 100%; margin-top: 1em; }
    th, td { border: 1px solid #ccc; padding: 0.5em; text-align: center; }
  </style>
</head>
<body>
  <h1>학생 성적 조회</h1>
  <form id="searchForm">
    <label>이름:<br><input type="text" id="name" required></label><br><br>
    <label>생년월일 (YYMMDD):<br><input type="text" id="birth" pattern="\d{6}" required></label><br><br>
    <label>전화번호:<br><input type="text" id="phone" required></label><br><br>
    <button type="submit">조회</button>
  </form>

  <div id="results"></div>

  <script>
    function displayGrades(data) {
      const container = document.getElementById('results');
      container.innerHTML = '';
      if (!data || data.length === 0) {
        container.textContent = '조회 결과가 없습니다.';
        return;
      }
      const table = document.createElement('table');
      const header = ['이름','과목','단원명','성적'];
      const trh = document.createElement('tr');
      header.forEach(h => {
        const th = document.createElement('th');
        th.textContent = h;
        trh.appendChild(th);
      });
      table.appendChild(trh);
      data.forEach(item => {
        const tr = document.createElement('tr');
        header.forEach(h => {
          const td = document.createElement('td');
          const key = h === '단원명' ? 'unit' : (h === '과목' ? 'subject' : (h === '성적' ? 'score' : 'name'));
          td.textContent = item[key];
          tr.appendChild(td);
        });
        table.appendChild(tr);
      });
      container.appendChild(table);
    }

    document.getElementById('searchForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const name  = encodeURIComponent(document.getElementById('name').value.trim());
      const birth = encodeURIComponent(document.getElementById('birth').value.trim());
      const phone = encodeURIComponent(document.getElementById('phone').value.trim());
      const url = 'https://script.google.com/macros/s/AKfycbyBECGVSuJA535k8IV4tmOM9VSU6Br-uHSAnQT8GakoAc0YdSAYkTDV5PgN_bVNJoXRYQ/exec'
        + `?name=${name}`
        + `&birth=${birth}`
        + `&phone=${phone}`
        + `&callback=displayGrades`;

      const old = document.getElementById('jsonp');
      if (old) old.remove();

      const script = document.createElement('script');
      script.id = 'jsonp';
      script.src = url;
      document.body.appendChild(script);
    });
  </script>
</body>
</html>